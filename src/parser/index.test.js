import fs from "fs";
import { parseImage } from ".";
import { shaFromJSON /* , toJSONString */ } from "../testUtils";

describe("parser tests", () => {
	const path = "./test/medical.nema.org/";

	const fileNameToTagHash = {
		"compsamples_j2k/IMAGES/J2KI/CT1_J2KI": "b3dfaa9391a0d0610d080f1afbbfa3c17e42da62",
		"compsamples_j2k/IMAGES/J2KI/CT2_J2KI": "731e3636ad18e6a836b726b1baaa4dba6e0755df",
		"compsamples_j2k/IMAGES/J2KI/MG1_J2KI": "26eb871a2be96bae56dc900668e5a9a18ab0a9ff",
		"compsamples_j2k/IMAGES/J2KI/MR1_J2KI": "4691dbbff1ed1dc1f194c0005675daeedb50c166",
		"compsamples_j2k/IMAGES/J2KI/MR2_J2KI": "629d258ee14b60e348c3106175af8ee7712c495d",
		"compsamples_j2k/IMAGES/J2KI/MR3_J2KI": "b154d58a25ae01b0f3230a63cb1275279b806f59",
		"compsamples_j2k/IMAGES/J2KI/MR4_J2KI": "d8edf414ef7258fb4cd6b7e013063cc562256d1a",
		"compsamples_j2k/IMAGES/J2KI/NM1_J2KI": "0e445d8151f9a9cbb780b85ead9f2fa6015321df",
		"compsamples_j2k/IMAGES/J2KI/RG1_J2KI": "b93ebbe9a7590b5b271a7916b9c229b8edb26870",
		"compsamples_j2k/IMAGES/J2KI/RG2_J2KI": "e639ca567c2bfc32adfb1d5565d03d3e4743a652",
		"compsamples_j2k/IMAGES/J2KI/RG3_J2KI": "be5a5dff6bed27087bf35125898630acf5f8876f",
		"compsamples_j2k/IMAGES/J2KI/SC1_J2KI": "2a079fc11308c5e0f8cd233cf9fd62a86c453089",
		"compsamples_j2k/IMAGES/J2KI/US1_J2KI": "4f7be2f4c49d22e94e8badd3948abcef1be578f6",
		"compsamples_j2k/IMAGES/J2KI/VL1_J2KI": "47cdf883f29830f48b6a2d326350057b614340ab",
		"compsamples_j2k/IMAGES/J2KI/VL2_J2KI": "95bfea35709bc681f27222e76aef70dce907e972",
		"compsamples_j2k/IMAGES/J2KI/VL3_J2KI": "f56b1c445aa229cdfe072f2ba581f6dcf42ecec6",
		"compsamples_j2k/IMAGES/J2KI/VL4_J2KI": "5bc6a420439b5417cd7027bbcfea501e56a6f611",
		"compsamples_j2k/IMAGES/J2KI/VL5_J2KI": "38bacd4784cf1835770f682b4e288221f98228b8",
		"compsamples_j2k/IMAGES/J2KI/VL6_J2KI": "30106fd526f0cd139abd25e4d4b3a2c0ff9f4155",
		"compsamples_j2k/IMAGES/J2KI/XA1_J2KI": "91cf110c60f34f2ccaa21e401067b23bac15d0f5",
		"compsamples_j2k/IMAGES/J2KR/CT1_J2KR": "79fed8f1977989a5d6e6930be918d070870d1ea8",
		"compsamples_j2k/IMAGES/J2KR/CT2_J2KR": "28abf42ef12795e4295b5dfe22d7b4592eb00d99",
		"compsamples_j2k/IMAGES/J2KR/MG1_J2KR": "e4cbbdddffb660751fc3e092631d50ecf16b2c9a",
		"compsamples_j2k/IMAGES/J2KR/MR1_J2KR": "ad48458040d1fd4efae7ca4287b6b7b5fbfa0dc3",
		"compsamples_j2k/IMAGES/J2KR/MR2_J2KR": "26336d85e2875decad6beda8f67e75dc36158496",
		"compsamples_j2k/IMAGES/J2KR/MR3_J2KR": "0bffeab96f7d319421726af4ca047203d60f8e28",
		"compsamples_j2k/IMAGES/J2KR/MR4_J2KR": "86cf8ac7b8c01bfecfa30d038dc481310fcd6294",
		"compsamples_j2k/IMAGES/J2KR/NM1_J2KR": "5d75a31984adba75deba5bc5d9429926970702dc",
		"compsamples_j2k/IMAGES/J2KR/RG1_J2KR": "d03b461689fb723ca9cbf9266fbd4f3f5ab4df6a",
		"compsamples_j2k/IMAGES/J2KR/RG2_J2KR": "3e7a39fc043578b220c9a253cd45a4b6f487e1a2",
		"compsamples_j2k/IMAGES/J2KR/RG3_J2KR": "7344a77d13f37b99c3b82d7dccbb5da0fb0f4660",
		"compsamples_j2k/IMAGES/J2KR/SC1_J2KR": "f857ec099245fed5abe80fc7ca7fee64a205f2d6",
		"compsamples_j2k/IMAGES/J2KR/US1_J2KR": "1ef1b51ada014f511549471759d2ed3b4d9c68fb",
		"compsamples_j2k/IMAGES/J2KR/VL1_J2KR": "918c7d177e8bfb189c240b6892a194ce71385a0a",
		"compsamples_j2k/IMAGES/J2KR/VL2_J2KR": "17c2027d8323efcc1a2a0c085ed27726ffc49f91",
		"compsamples_j2k/IMAGES/J2KR/VL3_J2KR": "589ff57c9b79b31910d05485555f1aa495fd2bfa",
		"compsamples_j2k/IMAGES/J2KR/VL4_J2KR": "7883e837682b97bb567c8681f08bb1737cb552ae",
		"compsamples_j2k/IMAGES/J2KR/VL5_J2KR": "2b661a74064573383868994a34e36874b1dc23a4",
		"compsamples_j2k/IMAGES/J2KR/VL6_J2KR": "c632531d230c63cc805db92ae5421d442dca84cf",
		"compsamples_j2k/IMAGES/J2KR/XA1_J2KR": "04911c7662e573e26a3e52a1911c8f859b6c5a52",
		"compsamples_jpeg/IMAGES/JPLL/CT1_JPLL": "c87b4468ebfb0c91e41fafafb00e45059562d18b",
		"compsamples_jpeg/IMAGES/JPLL/CT2_JPLL": "02cb1a1d22a2bb32a552e2513d3d3fb4c9e7bc62",
		"compsamples_jpeg/IMAGES/JPLL/MG1_JPLL": "14b914a351afaa7c5de0eb03a04166d6d9819f73",
		"compsamples_jpeg/IMAGES/JPLL/MR1_JPLL": "8e13093f75dd36113ce27d560c4c3f3577a2bf40",
		"compsamples_jpeg/IMAGES/JPLL/MR2_JPLL": "a84747e2d30ecf867b2515df4e6fecc3522aebb2",
		"compsamples_jpeg/IMAGES/JPLL/MR3_JPLL": "b8779e2b3b9b5db85161ed4a494fc9a41e302f4d",
		"compsamples_jpeg/IMAGES/JPLL/MR4_JPLL": "5e5ee219b89be95b01a5acff04ca1cff11c0b2c7",
		"compsamples_jpeg/IMAGES/JPLL/NM1_JPLL": "476413615da362382af1080a5f8b8f65b40c7788",
		"compsamples_jpeg/IMAGES/JPLL/RG1_JPLL": "ff76e8031855382f2801f28611a0293db8976756",
		"compsamples_jpeg/IMAGES/JPLL/RG2_JPLL": "fe314a4bac6ac4503be2e4fa2b2240ed4c30101b",
		"compsamples_jpeg/IMAGES/JPLL/RG3_JPLL": "3d6fd8016a28bea80a1986acc5ecd49f22c646f7",
		"compsamples_jpeg/IMAGES/JPLL/SC1_JPLL": "5d618943d2f00c5829450b52c0ccd4799301fcbf",
		"compsamples_jpeg/IMAGES/JPLL/XA1_JPLL": "d4a3df9ff823d3b4e76060323139d1e7bb855215",
		"compsamples_jpeg/IMAGES/JPLY/MG1_JPLY": "9fbeeaf7536ad836e2fb2f103fe3a1a56ff0f3dc",
		"compsamples_jpeg/IMAGES/JPLY/MR1_JPLY": "c5565b063a788b0dcfb433e1bc22b14177df40be",
		"compsamples_jpeg/IMAGES/JPLY/MR2_JPLY": "60774cd07c1382a1052a40e7d263db37d125f689",
		"compsamples_jpeg/IMAGES/JPLY/MR3_JPLY": "06ce3e130bf1e0fd121c128a120b8b9cdfe9ea76",
		"compsamples_jpeg/IMAGES/JPLY/MR4_JPLY": "8cee5f1bde9c9fb3759467573149b5de2d4a51e3",
		"compsamples_jpeg/IMAGES/JPLY/NM1_JPLY": "b2a5e293ec39aeaf01c365509facce9a51cb578d",
		"compsamples_jpeg/IMAGES/JPLY/RG2_JPLY": "5f79a8b8a61880d5228d19090a5f4e120e01a290",
		"compsamples_jpeg/IMAGES/JPLY/RG3_JPLY": "81589244f5a5dbf3b7b422a697d9eb8dba84e9db",
		"compsamples_jpeg/IMAGES/JPLY/SC1_JPLY": "8bc0acfa9bcc4203e6aae2247e0f19362540fe17",
		"compsamples_jpeg/IMAGES/JPLY/XA1_JPLY": "b647260f4cf0aaa1a6c8109f48512bf7939af260",
		"compsamples_jpegls/IMAGES/JLSL/CT1_JLSL": "1d91bb112fc48045cfba0c651496acfb5b11e1d4",
		"compsamples_jpegls/IMAGES/JLSL/CT2_JLSL": "712f1932f16f90b043d94d92ac33f249ed7aec95",
		"compsamples_jpegls/IMAGES/JLSL/MG1_JLSL": "6c4944aeab86cec7db563a8f226849fe586ed6f2",
		"compsamples_jpegls/IMAGES/JLSL/MR1_JLSL": "827fee14691e6844c72ed277a5585f8fe78fbac8",
		"compsamples_jpegls/IMAGES/JLSL/MR2_JLSL": "6a3b8648861c2a9a646c0c4e103b224cb75b1f1c",
		"compsamples_jpegls/IMAGES/JLSL/MR3_JLSL": "c1c950c3f48bd909c6163c1d76df76d4302fd60f",
		"compsamples_jpegls/IMAGES/JLSL/MR4_JLSL": "b057ac27f1aae9e2e494b42b59254ced2c3ab06a",
		"compsamples_jpegls/IMAGES/JLSL/NM1_JLSL": "aafe152f17fe87f6e7f736380584e8978dda7870",
		"compsamples_jpegls/IMAGES/JLSL/RG1_JLSL": "5a99511586f9b6042b0aff902d3af66963864b44",
		"compsamples_jpegls/IMAGES/JLSL/RG2_JLSL": "4e662e39b0e12b506120bd3de0ae4d428702bbef",
		"compsamples_jpegls/IMAGES/JLSL/RG3_JLSL": "08fb97f73a5393da403911f8aefd23a672a5541a",
		"compsamples_jpegls/IMAGES/JLSL/SC1_JLSL": "402e0cdeefc7227e90b8238935d50f677931530c",
		"compsamples_jpegls/IMAGES/JLSL/XA1_JLSL": "4ad2444a7a7b1869043025d2ecf08f107f4a9104",
		"compsamples_jpegls/IMAGES/JLSN/CT1_JLSN": "85a64cd556446f83821abaa275fe2ae961478443",
		"compsamples_jpegls/IMAGES/JLSN/CT2_JLSN": "59c457e1a4347e959eef7c3797cdfb01a9f4d128",
		"compsamples_jpegls/IMAGES/JLSN/MG1_JLSN": "6fb14beb2426a493f6a1b2cb902693d14b4090ed",
		"compsamples_jpegls/IMAGES/JLSN/MR1_JLSN": "2ff9734602e5a01282819881681f10230b8f16ae",
		"compsamples_jpegls/IMAGES/JLSN/MR2_JLSN": "78abe05454e115aafae41092e0e57f027a1927de",
		"compsamples_jpegls/IMAGES/JLSN/MR3_JLSN": "c6b7419c0ced41c869a562453506b05d67c39709",
		"compsamples_jpegls/IMAGES/JLSN/MR4_JLSN": "f628881cac04b610068519cc2818eeaa5d41c8d7",
		"compsamples_jpegls/IMAGES/JLSN/NM1_JLSN": "0b6e9cc6de26e0ba7bb0da3dd76416e0e5ef2dba",
		"compsamples_jpegls/IMAGES/JLSN/RG1_JLSN": "33f065f2b40c50cb2a9d8e58b9212ff700b1c06f",
		"compsamples_jpegls/IMAGES/JLSN/RG2_JLSN": "fe775dd0ae01333855f1fe036c9d5e868e9f740e",
		"compsamples_jpegls/IMAGES/JLSN/RG3_JLSN": "8713792a86b0461144b8505acea857800184e39a",
		"compsamples_jpegls/IMAGES/JLSN/SC1_JLSN": "09bf4afbda8794e488d5618d0b2453d9df75ec86",
		"compsamples_jpegls/IMAGES/JLSN/XA1_JLSN": "292a3945526ab4e8a5f1dd031834485c1823a56f",
		"compsamples_refanddir/IMAGES/REF/CT1_UNC": "e82eaff60ea29cb8e053487d75d68124d24cb0a7",
		"compsamples_refanddir/IMAGES/REF/CT2_UNC": "d1a9dc9d357339152e0109421d69ada845299952",
		"compsamples_refanddir/IMAGES/REF/MG1_UNC": "f32571784f1bda0b46f95305f5b29087b6ce9b2a",
		"compsamples_refanddir/IMAGES/REF/MR1_UNC": "afe302b02519c029328b6a4cb2e744146679ba57",
		"compsamples_refanddir/IMAGES/REF/MR2_UNC": "7eb77babc268bf1ab1a7d2159f7fedb85d6d6ea1",
		"compsamples_refanddir/IMAGES/REF/MR3_UNC": "1e3b4f65b051f01249786977efe480ebee5f7544",
		"compsamples_refanddir/IMAGES/REF/MR4_UNC": "9cc266190c809261d6f6bf6acc4deed89cd19f51",
		"compsamples_refanddir/IMAGES/REF/NM1_UNC": "0b7048f2d02c3037057e2431999ed447c3e85505",
		"compsamples_refanddir/IMAGES/REF/RG1_UNC": "5045d80a9010345f10fd01d8f35f53b313f2221b",
		"compsamples_refanddir/IMAGES/REF/RG2_UNC": "6e203caf21a62cc06ef077206060af79fbeae0bb",
		"compsamples_refanddir/IMAGES/REF/RG3_UNC": "532ee0ccdafa7ae1e647409f69f6f0fb6ea87351",
		"compsamples_refanddir/IMAGES/REF/SC1_UNC": "8e40f13f760a153afdd02db9239085ccbf2a96f7",
		"compsamples_refanddir/IMAGES/REF/US1_UNC": "d4abc7ff1c267eba4a382c9a920c5b2ba307b6ba",
		"compsamples_refanddir/IMAGES/REF/VL1_UNC": "240cea2241048a9f207df9c761eaedf03d0d01a4",
		"compsamples_refanddir/IMAGES/REF/VL2_UNC": "9fa709da0da1bdce2e6045c8a3adacf6eac360ff",
		"compsamples_refanddir/IMAGES/REF/VL3_UNC": "8c386bfa150b9686627a928201d46ca6b3523d49",
		"compsamples_refanddir/IMAGES/REF/VL4_UNC": "3424e922a28a2ac770e6ac6a17c7ed2b8c85ca3e",
		"compsamples_refanddir/IMAGES/REF/VL5_UNC": "1d958d6472831cb454cd1a64e305131e50bd419f",
		"compsamples_refanddir/IMAGES/REF/VL6_UNC": "6de647f70d999ef1842286ea76117d337f4f6e20",
		"compsamples_refanddir/IMAGES/REF/XA1_UNC": "9cc2fee303846667136a3c2b711d689809e67e26",
		"compsamples_rle_20040210/IMAGES/RLE/CT1_RLE": "c8bd0e4736fb8c9c1e6a3b005a43373f41a87848",
		"compsamples_rle_20040210/IMAGES/RLE/CT2_RLE": "3127371cb05e16f6d6b6bb4e3c6ab55c078e2102",
		"compsamples_rle_20040210/IMAGES/RLE/MG1_RLE": "9895ce96ab7587278bbbf1794120ea8ed84778af",
		"compsamples_rle_20040210/IMAGES/RLE/MR1_RLE": "432b17484ba6cab913524e625a19c53dc7463e9e",
		"compsamples_rle_20040210/IMAGES/RLE/MR2_RLE": "5e74c58042dc000f4b2263ea01f55e05f4c9fcde",
		"compsamples_rle_20040210/IMAGES/RLE/MR3_RLE": "7da47caae0bddadd93d8af2e932506e776f19f6f",
		"compsamples_rle_20040210/IMAGES/RLE/MR4_RLE": "e1ef90fff70c1f383fb1476d5af84a70aba2598d",
		"compsamples_rle_20040210/IMAGES/RLE/NM1_RLE": "063ea948e9f8dd11bbdbbcdc09dde3b9fc71cba6",
		"compsamples_rle_20040210/IMAGES/RLE/RG1_RLE": "bdeea4ca4f68194a9d2e2fa46063786345ab2e3e",
		"compsamples_rle_20040210/IMAGES/RLE/RG2_RLE": "08a77ef5e4a0894e9d1c76d2d97fa1f636017ca0",
		"compsamples_rle_20040210/IMAGES/RLE/RG3_RLE": "43b20f5d0226c085ce98e22e26a52570e330bc60",
		"compsamples_rle_20040210/IMAGES/RLE/SC1_RLE": "ab1f365b35959b68731b807f6bf1f56bc1b78703",
		"compsamples_rle_20040210/IMAGES/RLE/US1_RLE": "e0b51e714c911b54025f3530b2acc5fdd79153cd",
		"compsamples_rle_20040210/IMAGES/RLE/VL1_RLE": "8cca1f49c9569c2252bab0288bf5ecf9a0c01d34",
		"compsamples_rle_20040210/IMAGES/RLE/VL2_RLE": "eeadceff6717d34a416b3408335210bb3616e8b8",
		"compsamples_rle_20040210/IMAGES/RLE/VL3_RLE": "314bde63e452ea273a34e0b037d8844b9e0a4427",
		"compsamples_rle_20040210/IMAGES/RLE/VL4_RLE": "2cea3fb4cc4f2c80cec1829de9b393d5edf8e926",
		"compsamples_rle_20040210/IMAGES/RLE/VL5_RLE": "a45c03730af4cb1bbf68cb48eeb6fe2b51f790c1",
		"compsamples_rle_20040210/IMAGES/RLE/VL6_RLE": "31e239952c997eaa6e4031089011e2c80189da34",
		"compsamples_rle_20040210/IMAGES/RLE/XA1_RLE": "df4bc02e0ca511a0c805092b8c9b218586137658",
		"multiframe/DISCIMG/IMAGES/BRMULTI": "5e8b419fb0f57d78a950a1dc59d3866bceec3647"
	};

	const fileKeys = Object.keys(fileNameToTagHash).sort();
	// let i = 0;
	fileKeys.forEach((key) => {
		it(`decodes RLE file ${key} OK`, () => {
			const data = fs.readFileSync(`${path}${key}`);
			const dataView = new DataView(new Uint8Array(data).buffer);
			const image = parseImage(dataView);
			expect(image).toBeTruthy();
			expect(image.tags).toBeTruthy();
			// console.log(toJSONString(image.tags));
			// fileNameToTagHash[key] = shaFromJSON(image.tags);
			expect(shaFromJSON(image.tags)).toEqual(fileNameToTagHash[key]);
			// i += 1;
			// if (i >= fileKeys.length) {
			// 	console.log(fileNameToTagHash);
			// }
		});
	});
});
