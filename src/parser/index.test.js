import fs from "fs";
import { parseImage } from ".";
import { shaFromJSON } from "../testUtils";

describe("parser tests", () => {
	const path = "./test/medical.nema.org/compsamples";

	const fileNameToTagHash = {
		"_j2k/IMAGES/J2KI/CT1_J2KI": "cff55e481909d8d58322a6012a43e3f65bd68ed0",
		"_j2k/IMAGES/J2KI/CT2_J2KI": "07250bcb8263e85e48211514a4c11fe4bcf05052",
		"_j2k/IMAGES/J2KI/MG1_J2KI": "e23615dc8cd185e18241d9c3b7d51f2aa9836e58",
		"_j2k/IMAGES/J2KI/MR1_J2KI": "3378aa424afa5855e7ccc4d672035fd662396afe",
		"_j2k/IMAGES/J2KI/MR2_J2KI": "1e35536a76de74b33483be7b4fabab8f450bcf87",
		"_j2k/IMAGES/J2KI/MR3_J2KI": "f096aac05e5f743594735dba205be2829baa7be0",
		"_j2k/IMAGES/J2KI/MR4_J2KI": "867396bda0e8fc870047f8ceb36535c4e4046bc4",
		"_j2k/IMAGES/J2KI/NM1_J2KI": "1b891a35c7f657b2f58ab72d98393430aa0431b7",
		"_j2k/IMAGES/J2KI/RG1_J2KI": "f20243e549ca69371132b4d772e5e27d20a52ba9",
		"_j2k/IMAGES/J2KI/RG2_J2KI": "a3de464e15b6e02e55a2cfe19ac0d51d1a5e8dfc",
		"_j2k/IMAGES/J2KI/RG3_J2KI": "cf8c55d0cad77e1ed116fcd8be29492033931208",
		"_j2k/IMAGES/J2KI/SC1_J2KI": "b550a5d8360514bccd6af356c61490ea18ecbdf2",
		"_j2k/IMAGES/J2KI/US1_J2KI": "d3a29ccde11ca15c859accd06b2b13111a1b5b99",
		"_j2k/IMAGES/J2KI/VL1_J2KI": "c6ecfa3b07911550ccf19e04adb6e979a98dccdf",
		"_j2k/IMAGES/J2KI/VL2_J2KI": "b856cd49e9027db25ea88537bc45a474d60a59d3",
		"_j2k/IMAGES/J2KI/VL3_J2KI": "0978777a042d9e879de5e837f761bb2251555ef3",
		"_j2k/IMAGES/J2KI/VL4_J2KI": "7acabf956cad27cf34cf8e0828a96a9c4a621324",
		"_j2k/IMAGES/J2KI/VL5_J2KI": "8167329ea4c612acc58d34fd72e231b212849829",
		"_j2k/IMAGES/J2KI/VL6_J2KI": "2125c4ec0475e53b6d82af399d1bb09334d54da2",
		"_j2k/IMAGES/J2KI/XA1_J2KI": "f75b1c852de2e2010b566268acc3c125ee86a1fa",
		"_j2k/IMAGES/J2KR/CT1_J2KR": "0bf9e0ecbdaaeea5d0d6f4e4b700bb1ef1eb0eba",
		"_j2k/IMAGES/J2KR/CT2_J2KR": "344f08ca8afe312cee54bafe7f2203ec3830c48d",
		"_j2k/IMAGES/J2KR/MG1_J2KR": "d26080e0a786803eeaba79f28240b3bee9441ca7",
		"_j2k/IMAGES/J2KR/MR1_J2KR": "8db87e32b1acaf611f9ce213fa4107fc33e8bb70",
		"_j2k/IMAGES/J2KR/MR2_J2KR": "a36c779be17192d098a1e840b71e1f0e98f66c18",
		"_j2k/IMAGES/J2KR/MR3_J2KR": "1a957d1149ffb84c6750863cb8e68043e6f9b59a",
		"_j2k/IMAGES/J2KR/MR4_J2KR": "a33b99399169d8584d025d94b21f3850f376c638",
		"_j2k/IMAGES/J2KR/NM1_J2KR": "bb5d1df9a7d3c74c569ca88a2d4310a3f4bbf1ab",
		"_j2k/IMAGES/J2KR/RG1_J2KR": "1a05a2b521d34ce6c3634e60f1c2ec8eccd03c22",
		"_j2k/IMAGES/J2KR/RG2_J2KR": "ebd189bf9b9f34d390b641f0f686b37632391efb",
		"_j2k/IMAGES/J2KR/RG3_J2KR": "92a75ee9357a8d4e9fff5b539854bb728f2c1bf4",
		"_j2k/IMAGES/J2KR/SC1_J2KR": "073bf793a4010911e44c41e95bfdccd5474982f8",
		"_j2k/IMAGES/J2KR/US1_J2KR": "06dfb536f7218a80d57933c5413f7bb2ab8b84ff",
		"_j2k/IMAGES/J2KR/VL1_J2KR": "4d6c911c4c9716077f00ad2f55c7ebf1f91dcacd",
		"_j2k/IMAGES/J2KR/VL2_J2KR": "236a9378191bcc26da7118a0990246f83305408e",
		"_j2k/IMAGES/J2KR/VL3_J2KR": "27281bb6827f2634d259e4d758a4ea5f786ca2c3",
		"_j2k/IMAGES/J2KR/VL4_J2KR": "ed70305f48b9724c24721dc6631a4e5adf3131ff",
		"_j2k/IMAGES/J2KR/VL5_J2KR": "c372c856efbc0732a25c3d53b11ee8f32c6f9b53",
		"_j2k/IMAGES/J2KR/VL6_J2KR": "18a29364b515f4c68a80778e7f738b5b6bbb8a45",
		"_j2k/IMAGES/J2KR/XA1_J2KR": "2aa4f492183de19d14cad58095964567bd52dae8",
		"_jpeg/IMAGES/JPLL/CT1_JPLL": "8f6c054a74b86487a3ad17fca3975291c5b71f17",
		"_jpeg/IMAGES/JPLL/CT2_JPLL": "fe14097c663b6e52dc46a8d87d2049a41df9166f",
		"_jpeg/IMAGES/JPLL/MG1_JPLL": "2879ec403eb507c464204fd8e54dbcd7f8f5a9a4",
		"_jpeg/IMAGES/JPLL/MR1_JPLL": "7eb06962376f4572af2d99c5273a0be16746973a",
		"_jpeg/IMAGES/JPLL/MR2_JPLL": "7fbe2564829b8b552d01f4f0fd40b3d58c7218c6",
		"_jpeg/IMAGES/JPLL/MR3_JPLL": "144772829dbfff94bcfb03067f2605d4e9174253",
		"_jpeg/IMAGES/JPLL/MR4_JPLL": "01c31554325fe6cc6dd1389a531c932fe65b18ed",
		"_jpeg/IMAGES/JPLL/NM1_JPLL": "9582c9697524a89724f373d30645ee477a5309c9",
		"_jpeg/IMAGES/JPLL/RG1_JPLL": "b199ba450002511357f5d67ffa73c90a8bd72c5a",
		"_jpeg/IMAGES/JPLL/RG2_JPLL": "0a1ac7c27fa2aed0ab81dc5969fe6f5311409703",
		"_jpeg/IMAGES/JPLL/RG3_JPLL": "ec77e49ce0e4a1e5f79e0d974516dc917c281265",
		"_jpeg/IMAGES/JPLL/SC1_JPLL": "7941bf0a06b3446a32ef87e01023150b15d6ff10",
		"_jpeg/IMAGES/JPLL/XA1_JPLL": "d6059472b80d60adf11a0d058ec74b1b39f00a44",
		"_jpeg/IMAGES/JPLY/MG1_JPLY": "7b968baa9c741604814372767b250b8cde27a9e1",
		"_jpeg/IMAGES/JPLY/MR1_JPLY": "7bb1dbe1dee1471c5fab81ae3d20c4efacbe3789",
		"_jpeg/IMAGES/JPLY/MR2_JPLY": "3ef5ecaf0fe0d313a1375a358db4a77a8240c4c3",
		"_jpeg/IMAGES/JPLY/MR3_JPLY": "52b43ba7c249f5e3b0d0853f08441cd50126f9d7",
		"_jpeg/IMAGES/JPLY/MR4_JPLY": "6d936e37a3161304c9f3ac96a714a54745b3d6b5",
		"_jpeg/IMAGES/JPLY/NM1_JPLY": "b7112b96ba854d30f4b3066e5289f220da2be674",
		"_jpeg/IMAGES/JPLY/RG2_JPLY": "b12b61d9d09c1247d2af8bd87e0406dc40132722",
		"_jpeg/IMAGES/JPLY/RG3_JPLY": "a349ee81265ca0b20230a5591962e2ddd8c2125d",
		"_jpeg/IMAGES/JPLY/SC1_JPLY": "528eeebdcab84e259f5dd91b06efc791b4f72d58",
		"_jpeg/IMAGES/JPLY/XA1_JPLY": "6e5764fea0f8e1dc48f7715c670837fa39d86477",
		"_jpegls/IMAGES/JLSL/CT1_JLSL": "e9a97172d0660ff131c8ff9032b8cd5b0ab015b8",
		"_jpegls/IMAGES/JLSL/CT2_JLSL": "a91d3010ae52fa16e3123c564642066eddaac97f",
		"_jpegls/IMAGES/JLSL/MG1_JLSL": "b17c9126146910935c6c9a1745f030322fdc0ce1",
		"_jpegls/IMAGES/JLSL/MR1_JLSL": "85327e7c4e5794363a9c6391d406db1340d44863",
		"_jpegls/IMAGES/JLSL/MR2_JLSL": "d01dab653994b515bc426a4d3b0db23399f92ad9",
		"_jpegls/IMAGES/JLSL/MR3_JLSL": "97ee89e7610596eed0603ad216acbc16045045aa",
		"_jpegls/IMAGES/JLSL/MR4_JLSL": "8e6cd1fe5e7191c40e8ac32ca2331d6a94fd1f3e",
		"_jpegls/IMAGES/JLSL/NM1_JLSL": "23dce4557a70a66fbf96613c555407398a5d6c1f",
		"_jpegls/IMAGES/JLSL/RG1_JLSL": "3caf0039cb1457556bd4d8ca354681cd456b9c41",
		"_jpegls/IMAGES/JLSL/RG2_JLSL": "00c9bca63be5ea2fa15fc34e4c8c638dc111f551",
		"_jpegls/IMAGES/JLSL/RG3_JLSL": "6d8a81741177b3d2e4f5d7343c1743fa114c235b",
		"_jpegls/IMAGES/JLSL/SC1_JLSL": "e0ff5bb457938d82eaecb378be16591b6bbcb7ec",
		"_jpegls/IMAGES/JLSL/XA1_JLSL": "f9f69bd52377f8e38b85bff4fb09e7898100a458",
		"_jpegls/IMAGES/JLSN/CT1_JLSN": "d789dcc198205c5f3edc3fe5d37fb31544af2d3e",
		"_jpegls/IMAGES/JLSN/CT2_JLSN": "30f9fd64d711af63fc9eccf72b904437599777a1",
		"_jpegls/IMAGES/JLSN/MG1_JLSN": "3ac111163faa2c2768271e27b733444beb4da527",
		"_jpegls/IMAGES/JLSN/MR1_JLSN": "effafc85305581ff7d5c04c0fa393b9bfeb43bec",
		"_jpegls/IMAGES/JLSN/MR2_JLSN": "405a64e37e8db307c7b9c27a9e008b3557439769",
		"_jpegls/IMAGES/JLSN/MR3_JLSN": "b5941d2dd0ade40b4d931216da381e20979dcc69",
		"_jpegls/IMAGES/JLSN/MR4_JLSN": "9986afcd506144f7cbcc9af6d68b711c48a725b8",
		"_jpegls/IMAGES/JLSN/NM1_JLSN": "6b23a36705a947ed661d46cb9ff699e8ddb98a70",
		"_jpegls/IMAGES/JLSN/RG1_JLSN": "704622a4ae83c766e31723642a5676e61c59b12c",
		"_jpegls/IMAGES/JLSN/RG2_JLSN": "13d573fbe49baa380b1435165316b8006972091a",
		"_jpegls/IMAGES/JLSN/RG3_JLSN": "2a1cda5a7f76c34f7b36e6c6e965b1fcae29b2ce",
		"_jpegls/IMAGES/JLSN/SC1_JLSN": "715e45d5e109b9aa11c62ee62dd20d7fdd22c62e",
		"_jpegls/IMAGES/JLSN/XA1_JLSN": "9e9fe2ebb5eb3ca895985c84994181e70bf5cb76",
		"_refanddir/IMAGES/REF/CT1_UNC": "d5822bec94196c6f09ffe6fb31047f5ee1de0f98",
		"_refanddir/IMAGES/REF/CT2_UNC": "a7bed616466e9e193419c7925976d529e15cb48e",
		"_refanddir/IMAGES/REF/MG1_UNC": "f34d29728619fb26e517fa6a7089335bf5d27569",
		"_refanddir/IMAGES/REF/MR1_UNC": "1e9ceae5926d717565f312f909f6b9e0c9de3172",
		"_refanddir/IMAGES/REF/MR2_UNC": "6fce8820bf147fcdc17042e1e738546014f08e87",
		"_refanddir/IMAGES/REF/MR3_UNC": "376beb895cf4a4303ee02e8591aa97468da0ad58",
		"_refanddir/IMAGES/REF/MR4_UNC": "d45271926b2e094e5ab1e81ef037ab400c79df11",
		"_refanddir/IMAGES/REF/NM1_UNC": "e56ea6c719e0bfcfed319969a7aedeb19498ded3",
		"_refanddir/IMAGES/REF/RG1_UNC": "b01fd886bb5464992f5bc7f27887a1fd8ca8e73b",
		"_refanddir/IMAGES/REF/RG2_UNC": "8fd9b7134c6ece9ba37de1e9527b49d3e29de7a8",
		"_refanddir/IMAGES/REF/RG3_UNC": "1f584272901da5f34065ea56eb618f7a8e16f21e",
		"_refanddir/IMAGES/REF/SC1_UNC": "c6529918aba9c3ceb539cd207b8da835cb8d8535",
		"_refanddir/IMAGES/REF/US1_UNC": "61bca76bcf8d83bf394433c0da2b5017d2879d08",
		"_refanddir/IMAGES/REF/VL1_UNC": "0036d2791bd5740a183cb03b649d67a63dcdc139",
		"_refanddir/IMAGES/REF/VL2_UNC": "649a6306fadd58d9329c08a0732fc5fd4afc1e17",
		"_refanddir/IMAGES/REF/VL3_UNC": "97513199cd6745780cc21c0e9832b7b005071d18",
		"_refanddir/IMAGES/REF/VL4_UNC": "319c1bcf315cb568d97a1ee4fa60bca9fcd64580",
		"_refanddir/IMAGES/REF/VL5_UNC": "08665c9ab545d4bcd9b32faafdc94031ce5db62f",
		"_refanddir/IMAGES/REF/VL6_UNC": "7b2f4d4c0d610e759141bd673f864e937fbbfcc9",
		"_refanddir/IMAGES/REF/XA1_UNC": "e5e8a5a432ae1321fa285b5c97f04415d348081b",
		"_rle_20040210/IMAGES/RLE/CT1_RLE": "3d8997f92646231a6e2e08934ae310edb8ee04f8",
		"_rle_20040210/IMAGES/RLE/CT2_RLE": "48d085db85712505e47b3ca5522de44741990f76",
		"_rle_20040210/IMAGES/RLE/MG1_RLE": "c4b09327931633a333b4a6a5496bb41bdd8eec75",
		"_rle_20040210/IMAGES/RLE/MR1_RLE": "feda900cd0e5bae8397ed3495c4d8ede4d69116d",
		"_rle_20040210/IMAGES/RLE/MR2_RLE": "828125156bb6e1fa50100133e5de9995d4de6dd5",
		"_rle_20040210/IMAGES/RLE/MR3_RLE": "f086aa1fbe032d84e443ce42d99f97d575e6019b",
		"_rle_20040210/IMAGES/RLE/MR4_RLE": "82ab09a2e251c3458ade978e21f8f594d101f066",
		"_rle_20040210/IMAGES/RLE/NM1_RLE": "89df28d27f72ab3edef97a6e84b4eb6004b7535b",
		"_rle_20040210/IMAGES/RLE/RG1_RLE": "14af42739c3f0ba80ac5afd7db8deaafc93738ca",
		"_rle_20040210/IMAGES/RLE/RG2_RLE": "fd2723c6b4fbbe85022c4edc11e6befabad3d3cc",
		"_rle_20040210/IMAGES/RLE/RG3_RLE": "3c9de8eda32d600ce768aed03801f63ed686b07f",
		"_rle_20040210/IMAGES/RLE/SC1_RLE": "d11bda46fbe47963b6be95b49ad2e818e88beee1",
		"_rle_20040210/IMAGES/RLE/US1_RLE": "e62b76842b267a5eb95322910c55bdc640acb401",
		"_rle_20040210/IMAGES/RLE/VL1_RLE": "2fd5d02af779a57c422bbedd7d1009e50157f5dd",
		"_rle_20040210/IMAGES/RLE/VL2_RLE": "a631ed25e58389b58e74d90d6ff883bbaf73e83f",
		"_rle_20040210/IMAGES/RLE/VL3_RLE": "399e95ef3398708021fea1f66bab3c6f98d5c263",
		"_rle_20040210/IMAGES/RLE/VL4_RLE": "3c6a1d22170ef3dbbb213161830c42efaea71806",
		"_rle_20040210/IMAGES/RLE/VL5_RLE": "97ea97ef2609504cf2de65d8915678d4efe31473",
		"_rle_20040210/IMAGES/RLE/VL6_RLE": "8907ec48b77ae08ab865a7e1f20951e0533bf69e",
		"_rle_20040210/IMAGES/RLE/XA1_RLE": "b502626a7cfacf3893a90126e863cb45eaad9ae7"
	};

	const fileKeys = Object.keys(fileNameToTagHash).sort();
	// let i = 0;
	fileKeys.forEach((key) => {
		it(`decodes RLE file ${key} OK`, () => {
			const data = fs.readFileSync(`${path}${key}`);
			const dataView = new DataView(new Uint8Array(data).buffer);
			const image = parseImage(dataView);
			expect(image).toBeTruthy();
			expect(image.tags).toBeTruthy();
			// fileNameToTagHash[key] = shaFromJSON(image.tags);
			expect(shaFromJSON(image.tags)).toEqual(fileNameToTagHash[key]);
			// i += 1;
			// if (i >= fileKeys.length) {
			// 	console.log(fileNameToTagHash);
			// }
		});
	});
});
